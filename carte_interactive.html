<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAO Minecraft - Carte SAO Minecraft P1</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="navigation.css">
    <link rel="stylesheet" href="scrollbar.css">
    <link rel="stylesheet" href="sidenav.css">
    <link rel="stylesheet" href="footer.css">
    <style>
        .carte-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #FCE5C3 0%, #402C39 100%);
            padding: 2rem;
            padding-left: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .carte-title {
            font-size: 3rem;
            font-weight: bold;
            color: #402C39;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.2em;
            margin-bottom: 2rem;
            text-align: center;
            animation: fadeInDown 1s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .map-wrapper {
            position: relative;
            max-width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #mapCanvas {
            display: block;
            max-width: 100%;
            height: auto;
            cursor: pointer;
        }

        .zone-tooltip {
            position: absolute;
            background: rgba(64, 44, 57, 0.95);
            color: #FCE5C3;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
            border: 2px solid #FCE5C3;
        }

        .zone-tooltip.show {
            opacity: 1;
        }

        .zone-tooltip::before {
            content: 'üó∫Ô∏è ';
        }

        .instructions-box {
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #402C39;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 2rem;
            max-width: 800px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 1s ease-out 0.5s both;
        }

        .instructions-box h3 {
            color: #402C39;
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
        }

        .instructions-box p {
            color: #402C39;
            text-align: center;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .legend {
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #402C39;
            border-radius: 15px;
            padding: 20px;
            margin-top: 2rem;
            max-width: 800px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 1s ease-out 0.7s both;
        }

        .legend h3 {
            color: #402C39;
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
            border-bottom: 2px solid #402C39;
            padding-bottom: 10px;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(252, 229, 195, 0.3);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .legend-item:hover {
            background: rgba(252, 229, 195, 0.6);
            transform: translateX(5px);
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #402C39;
            flex-shrink: 0;
        }

        .legend-name {
            font-weight: 600;
            color: #402C39;
        }

        .import-section {
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #402C39;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 2rem;
            max-width: 800px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .import-section h3 {
            color: #402C39;
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
        }

        .import-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 2px solid #402C39;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .import-section button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #402C39 0%, #5a3d4f 100%);
            color: #FCE5C3;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .import-section button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(64, 44, 57, 0.3);
        }

        @media (max-width: 768px) {
            .carte-container {
                padding: 1rem;
                padding-left: 80px;
            }

            .carte-title {
                font-size: 2rem;
            }

            .legend-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="personal-footer">
        <div class="footer-content">
            <span class="discord-icon">üí¨</span>
            <span class="discord-label">Discord:</span>
            <span class="discord-username">yui028795</span>
        </div>
    </div>
    
    <nav class="sidenav">
        <a href="locations.html" class="sidenav-item" title="Lieux">
            <div class="sidenav-icon">üó∫Ô∏è</div>
            <div class="sidenav-text">Lieux</div>
        </a>
        <a href="mobs.html" class="sidenav-item" title="Mobs">
            <div class="sidenav-icon">üëπ</div>
            <div class="sidenav-text">Mobs</div>
        </a>
        <a href="ressources.html" class="sidenav-item" title="Ressources">
            <div class="sidenav-icon">‚õèÔ∏è</div>
            <div class="sidenav-text">Ressources</div>
        </a>
        <a href="items.html" class="sidenav-item" title="Items">
            <div class="sidenav-icon">üì¶</div>
            <div class="sidenav-text">Items</div>
        </a>
        <a href="quetes.html" class="sidenav-item" title="Qu√™tes">
            <div class="sidenav-icon">üìú</div>
            <div class="sidenav-text">Qu√™tes</div>
        </a>
        <a href="npc.html" class="sidenav-item" title="NPC">
            <div class="sidenav-icon">üë§</div>
            <div class="sidenav-text">NPC</div>
        </a>
        <a href="carte_interactive.html" class="sidenav-item active" title="Carte">
            <div class="sidenav-icon">üó∫Ô∏è</div>
            <div class="sidenav-text">Carte</div>
        </a>
    </nav>
    
    <a href="menu.html" class="nav-home-icon" title="Retour au menu principal"></a>
    <a href="locations.html" class="nav-back-icon" title="Retour aux lieux"></a>
    
    <div class="carte-container">
        <h1 class="carte-title">CARTE SAO MINECRAFT P1</h1>
        
        <div class="instructions-box">
            <h3>üìç Comment utiliser la carte</h3>
            <p>Survolez les zones color√©es pour voir leur nom, puis cliquez pour acc√©der aux informations d√©taill√©es du lieu.</p>
        </div>
        
        <div class="import-section" id="importSection" style="display: none;">
            <h3>üì• Importer les zones</h3>
            <p style="text-align: center; margin-bottom: 10px; color: #402C39;">Collez le JSON export√© depuis l'√©diteur de carte :</p>
            <textarea id="importData" placeholder='{"mapImage": "map.avif", "zones": [...]}'></textarea>
            <button id="importBtn">üì• Importer et Afficher</button>
        </div>
        
        <div id="loadingMessage" style="text-align: center; padding: 40px; font-size: 1.5rem; color: #402C39;">
            ‚è≥ Chargement de la carte...
        </div>
        
        <div class="map-wrapper" id="mapWrapper" style="display: none;">
            <canvas id="mapCanvas"></canvas>
        </div>
    </div>
    
    <div class="zone-tooltip" id="tooltip"></div>
    
    <script>
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        const tooltip = document.getElementById('tooltip');
        const importSection = document.getElementById('importSection');
        const mapWrapper = document.getElementById('mapWrapper');
        const importBtn = document.getElementById('importBtn');
        const importData = document.getElementById('importData');
        const loadingMessage = document.getElementById('loadingMessage');
        
        let zones = [
            {
                "name": "Ville du D√©part",
                "points": [
                    {"x": 530, "y": 1137}, {"x": 462, "y": 1153}, {"x": 408, "y": 1188}, {"x": 370, "y": 1260},
                    {"x": 357, "y": 1323}, {"x": 377, "y": 1402}, {"x": 432, "y": 1448}, {"x": 515, "y": 1483},
                    {"x": 607, "y": 1468}, {"x": 662, "y": 1431}, {"x": 697, "y": 1365}, {"x": 708, "y": 1297},
                    {"x": 686, "y": 1223}, {"x": 631, "y": 1168}, {"x": 581, "y": 1139}
                ],
                "color": "#3498db",
                "opacity": 0.3,
                "link": "ville_depart.html"
            },
            {
                "name": "Zonne Sanglier",
                "points": [
                    {"x": 438, "y": 1137}, {"x": 511, "y": 1010}, {"x": 596, "y": 1001},
                    {"x": 649, "y": 1069}, {"x": 653, "y": 1155}, {"x": 530, "y": 1124}
                ],
                "color": "#e67e22",
                "opacity": 0.3,
                "link": "mobs_zonne_sanglier.html"
            },
            {
                "name": "Quartier OG",
                "points": [
                    {"x": 684, "y": 920}, {"x": 622, "y": 925}, {"x": 618, "y": 949}, {"x": 609, "y": 968},
                    {"x": 622, "y": 995}, {"x": 640, "y": 1012}, {"x": 675, "y": 1010}, {"x": 703, "y": 1025},
                    {"x": 760, "y": 975}, {"x": 778, "y": 940}, {"x": 760, "y": 907}
                ],
                "color": "#95a5a6",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Hanaka",
                "points": [
                    {"x": 467, "y": 1064}, {"x": 451, "y": 1000}, {"x": 388, "y": 1048}, {"x": 443, "y": 1086}
                ],
                "color": "#e91e63",
                "opacity": 0.3,
                "link": "quete_secondaire_hanaka.html"
            },
            {
                "name": "Vallet des Loups",
                "points": [
                    {"x": 798, "y": 1101}, {"x": 741, "y": 1110}, {"x": 681, "y": 1173},
                    {"x": 725, "y": 1226}, {"x": 798, "y": 1213}, {"x": 815, "y": 1167}
                ],
                "color": "#607d8b",
                "opacity": 0.3,
                "link": "mobs_vallet_loups.html"
            },
            {
                "name": "Mar√©cage Putride",
                "points": [
                    {"x": 506, "y": 987}, {"x": 519, "y": 930}, {"x": 502, "y": 851}, {"x": 454, "y": 829},
                    {"x": 399, "y": 851}, {"x": 311, "y": 856}, {"x": 256, "y": 880}, {"x": 272, "y": 954},
                    {"x": 278, "y": 1009}, {"x": 353, "y": 1011}
                ],
                "color": "#27ae60",
                "opacity": 0.3,
                "link": "mobs_marecage_putride.html"
            },
            {
                "name": "Ruine Maudite",
                "points": [
                    {"x": 879, "y": 1332}, {"x": 852, "y": 1315}, {"x": 819, "y": 1323},
                    {"x": 819, "y": 1374}, {"x": 844, "y": 1385}, {"x": 872, "y": 1378}
                ],
                "color": "#8e44ad",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Ch√¢teau Abandonn√©",
                "points": [
                    {"x": 841, "y": 1398}, {"x": 813, "y": 1479}, {"x": 892, "y": 1479}, {"x": 903, "y": 1413}
                ],
                "color": "#34495e",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Archipel d'Ika",
                "points": [
                    {"x": 986, "y": 1214}, {"x": 964, "y": 1236}, {"x": 979, "y": 1280},
                    {"x": 1017, "y": 1280}, {"x": 1045, "y": 1247}, {"x": 1028, "y": 1214}
                ],
                "color": "#16a085",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Mizunari",
                "points": [
                    {"x": 944, "y": 1098}, {"x": 929, "y": 1122}, {"x": 936, "y": 1137}, {"x": 962, "y": 1131}
                ],
                "color": "#f39c12",
                "opacity": 0.3,
                "link": "quete_secondaire_mizunari.html"
            },
            {
                "name": "Champs de Mizunari",
                "points": [
                    {"x": 1015, "y": 1124}, {"x": 1004, "y": 1137}, {"x": 1008, "y": 1161}, {"x": 1045, "y": 1144}
                ],
                "color": "#f1c40f",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Castel Brume",
                "points": [
                    {"x": 933, "y": 960}, {"x": 846, "y": 844}, {"x": 804, "y": 872}, {"x": 883, "y": 964}
                ],
                "color": "#95a5a6",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Cyclorium",
                "points": [
                    {"x": 277, "y": 1006}, {"x": 216, "y": 1056}, {"x": 216, "y": 1139},
                    {"x": 279, "y": 1161}, {"x": 365, "y": 1142}, {"x": 365, "y": 1032}
                ],
                "color": "#9b59b6",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Mar√©cage de Vallhat",
                "points": [
                    {"x": 135, "y": 804}, {"x": 51, "y": 793}, {"x": 5, "y": 844}, {"x": 58, "y": 1032},
                    {"x": 111, "y": 1032}, {"x": 148, "y": 966}, {"x": 176, "y": 909}, {"x": 174, "y": 841}
                ],
                "color": "#1abc9c",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Campement Militaire",
                "points": [
                    {"x": 976, "y": 844}, {"x": 956, "y": 874}, {"x": 981, "y": 896},
                    {"x": 1002, "y": 896}, {"x": 1005, "y": 859}
                ],
                "color": "#c0392b",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Jardin des G√©ants",
                "points": [
                    {"x": 92, "y": 708}, {"x": 55, "y": 684}, {"x": 28, "y": 741},
                    {"x": 61, "y": 765}, {"x": 116, "y": 773}, {"x": 131, "y": 732}
                ],
                "color": "#2ecc71",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Vallhat",
                "points": [
                    {"x": 101, "y": 887}, {"x": 88, "y": 927}, {"x": 114, "y": 940}, {"x": 129, "y": 901}
                ],
                "color": "#98c3c7",
                "opacity": 0.3,
                "link": "vallhat.html"
            },
            {
                "name": "Arak'nol",
                "points": [
                    {"x": 291, "y": 346}, {"x": 342, "y": 381}, {"x": 309, "y": 419}, {"x": 324, "y": 440},
                    {"x": 289, "y": 486}, {"x": 300, "y": 515}, {"x": 353, "y": 493}, {"x": 438, "y": 425},
                    {"x": 449, "y": 366}, {"x": 429, "y": 329}, {"x": 379, "y": 333}, {"x": 337, "y": 302}
                ],
                "color": "#8b4513",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Vall√©e des P√©tales",
                "points": [
                    {"x": 374, "y": 1216}, {"x": 264, "y": 1168}, {"x": 181, "y": 1253},
                    {"x": 371, "y": 1415}, {"x": 352, "y": 1310}
                ],
                "color": "#ff69b4",
                "opacity": 0.3,
                "link": "vallee_petalles.html"
            },
            {
                "name": "Camp de Bandit",
                "points": [
                    {"x": 1333, "y": 1168}, {"x": 1265, "y": 1122}, {"x": 1160, "y": 1170}, {"x": 1259, "y": 1269}
                ],
                "color": "#e74c3c",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Guilde Marchande",
                "points": [
                    {"x": 1445, "y": 660}, {"x": 1386, "y": 738}, {"x": 1441, "y": 802},
                    {"x": 1498, "y": 793}, {"x": 1517, "y": 721}
                ],
                "color": "#f39c12",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Citadelle des Neiges",
                "points": [
                    {"x": 1233, "y": 581}, {"x": 1193, "y": 581}, {"x": 1195, "y": 614}, {"x": 1235, "y": 620}
                ],
                "color": "#ecf0f1",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Crystal de Tolbana",
                "points": [
                    {"x": 919, "y": 285}, {"x": 873, "y": 291}, {"x": 864, "y": 366},
                    {"x": 906, "y": 410}, {"x": 945, "y": 388}, {"x": 959, "y": 329}
                ],
                "color": "#3498db",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Tolbana",
                "points": [
                    {"x": 1038, "y": 440}, {"x": 1002, "y": 399}, {"x": 943, "y": 392}, {"x": 961, "y": 500},
                    {"x": 998, "y": 539}, {"x": 1046, "y": 517}, {"x": 1092, "y": 517}, {"x": 1110, "y": 447},
                    {"x": 1099, "y": 368}
                ],
                "color": "#3498db",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Donjon Kobold",
                "points": [
                    {"x": 1040, "y": 241}, {"x": 998, "y": 263}, {"x": 1016, "y": 311},
                    {"x": 1048, "y": 309}, {"x": 1066, "y": 270}
                ],
                "color": "#8e44ad",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Mine de Crystal",
                "points": [
                    {"x": 746, "y": 475}, {"x": 707, "y": 473}, {"x": 696, "y": 511},
                    {"x": 737, "y": 519}, {"x": 766, "y": 504}
                ],
                "color": "#3498db",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Virelune",
                "points": [
                    {"x": 470, "y": 559}, {"x": 439, "y": 574}, {"x": 444, "y": 603},
                    {"x": 474, "y": 605}, {"x": 481, "y": 574}
                ],
                "color": "#9b59b6",
                "opacity": 0.3,
                "link": ""
            },
            {
                "name": "Candelia",
                "points": [
                    {"x": 565, "y": 169}, {"x": 568, "y": 237}, {"x": 600, "y": 261},
                    {"x": 620, "y": 219}, {"x": 605, "y": 188}
                ],
                "color": "#e67e22",
                "opacity": 0.3,
                "link": ""
            }
        ];
        let img = new Image();
        let hoveredZone = null;
        
        // Fonction pour v√©rifier si un point est dans un polygone
        function isPointInPolygon(x, y, points) {
            let inside = false;
            for (let i = 0, j = points.length - 1; i < points.length; j = i++) {
                const xi = points[i].x, yi = points[i].y;
                const xj = points[j].x, yj = points[j].y;
                
                const intersect = ((yi > y) !== (yj > y))
                    && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
                if (intersect) inside = !inside;
            }
            return inside;
        }
        
        // Dessiner la carte avec les zones
        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);
            
            zones.forEach((zone, index) => {
                if (zone.points.length < 3) return;
                
                const isHovered = hoveredZone === index;
                const opacity = isHovered ? Math.min(zone.opacity + 0.2, 0.8) : zone.opacity;
                
                // Remplir la zone
                ctx.fillStyle = zone.color + Math.round(opacity * 255).toString(16).padStart(2, '0');
                ctx.beginPath();
                ctx.moveTo(zone.points[0].x, zone.points[0].y);
                for (let i = 1; i < zone.points.length; i++) {
                    ctx.lineTo(zone.points[i].x, zone.points[i].y);
                }
                ctx.closePath();
                ctx.fill();
                
                // Contour plus √©pais si survol√©
                ctx.strokeStyle = zone.color;
                ctx.lineWidth = isHovered ? 4 : 2;
                ctx.stroke();
                
                // Nom de la zone au centre
                const centerX = zone.points.reduce((sum, p) => sum + p.x, 0) / zone.points.length;
                const centerY = zone.points.reduce((sum, p) => sum + p.y, 0) / zone.points.length;
                
                ctx.fillStyle = '#fff';
                ctx.strokeStyle = '#000';
                ctx.lineWidth = isHovered ? 4 : 3;
                ctx.font = isHovered ? 'bold 20px Arial' : 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.strokeText(zone.name, centerX, centerY);
                ctx.fillText(zone.name, centerX, centerY);
            });
        }
        
        // G√©rer le mouvement de la souris
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            let foundZone = null;
            
            // V√©rifier si la souris est sur une zone (en ordre inverse pour priorit√©)
            for (let i = zones.length - 1; i >= 0; i--) {
                if (isPointInPolygon(x, y, zones[i].points)) {
                    foundZone = i;
                    break;
                }
            }
            
            if (foundZone !== null && foundZone !== hoveredZone) {
                hoveredZone = foundZone;
                canvas.style.cursor = 'pointer';
                
                // Afficher le tooltip (position absolue dans la page)
                tooltip.textContent = zones[foundZone].name;
                tooltip.style.left = (e.pageX + 15) + 'px';
                tooltip.style.top = (e.pageY - 40) + 'px';
                tooltip.classList.add('show');
                
                drawMap();
            } else if (foundZone === null && hoveredZone !== null) {
                hoveredZone = null;
                canvas.style.cursor = 'default';
                tooltip.classList.remove('show');
                drawMap();
            } else if (foundZone !== null) {
                // Mettre √† jour la position du tooltip (position absolue dans la page)
                tooltip.style.left = (e.pageX + 15) + 'px';
                tooltip.style.top = (e.pageY - 40) + 'px';
            }
        });
        
        // G√©rer le clic sur une zone
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            // V√©rifier si on clique sur une zone
            for (let i = zones.length - 1; i >= 0; i--) {
                if (isPointInPolygon(x, y, zones[i].points)) {
                    const zone = zones[i];
                    if (zone.link && zone.link.trim() !== '') {
                        window.location.href = zone.link;
                    } else {
                        alert(`Zone: ${zone.name}\n\nAucun lien configur√© pour cette zone.`);
                    }
                    break;
                }
            }
        });
        
        // Cacher le tooltip quand la souris quitte le canvas
        canvas.addEventListener('mouseleave', () => {
            hoveredZone = null;
            tooltip.classList.remove('show');
            canvas.style.cursor = 'default';
            drawMap();
        });
        
        // Importer les donn√©es
        importBtn.addEventListener('click', () => {
            try {
                const data = JSON.parse(importData.value);
                
                if (!data.zones || !Array.isArray(data.zones)) {
                    throw new Error('Format JSON invalide');
                }
                
                zones = data.zones;
                
                // Charger l'image
                img.src = data.mapImage || 'map.avif';
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    drawMap();
                    
                    // Afficher la carte et masquer l'import
                    importSection.style.display = 'none';
                    mapWrapper.style.display = 'block';
                };
                
                img.onerror = function() {
                    alert('Erreur: Impossible de charger l\'image de la carte. V√©rifiez que le fichier "' + (data.mapImage || 'map.avif') + '" existe.');
                };
                
            } catch (error) {
                alert('Erreur lors de l\'import: ' + error.message + '\n\nV√©rifiez que vous avez coll√© un JSON valide export√© depuis l\'√©diteur de carte.');
            }
        });
        
        // Fonction pour charger automatiquement la carte
        function loadMap() {
            loadingMessage.style.display = 'block';
            
            // Charger l'image directement
            img.src = 'map.avif';
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                drawMap();
                
                // Afficher la carte et masquer le chargement
                loadingMessage.style.display = 'none';
                importSection.style.display = 'none';
                mapWrapper.style.display = 'block';
            };
            
            img.onerror = function() {
                loadingMessage.style.display = 'none';
                importSection.style.display = 'block';
                alert('Erreur: Impossible de charger l\'image de la carte. V√©rifiez que le fichier "map.avif" existe dans le m√™me dossier.');
            };
        }
        
        // Charger au d√©marrage
        loadMap();
    </script>
</body>
</html>

